name: Test GSheet Write

on:
  workflow_dispatch: # 手動で実行

jobs:
  test-write:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install gspread google-auth

      - name: Test writing to Google Sheets
        env:
          GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
        run: |
          python - <<'EOF'
          import json
          import gspread
          from google.oauth2.service_account import Credentials

          SPREADSHEET_NAME = "カナダ監視設定"
          WORKSHEET_NAME = "config"
          CELL_LOCATION = "B2"

          creds_dict = json.loads("""${GOOGLE_CREDENTIALS}""")
          creds = Credentials.from_service_account_info(
              creds_dict,
              scopes=[
                  "https://www.googleapis.com/auth/spreadsheets",
                  "https://www.googleapis.com/auth/drive"
              ]
          )

          gc = gspread.authorize(creds)
          ws = gc.open(SPREADSHEET_NAME).worksheet(WORKSHEET_NAME)
          print(f"✅ Connected to sheet: {ws.title}")

          ws.update(CELL_LOCATION, "TEST COOKIE")
          print(f"✅ Test write completed: {CELL_LOCATION} updated to 'TEST COOKIE'")
          EOF
